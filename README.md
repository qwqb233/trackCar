# STM32智能小车控制系统

## 项目简介

这是一个基于STM32F103系列微控制器的智能小车控制系统，集成了多种传感器和执行器，实现循迹、避障、颜色识别等功能。项目采用模块化设计，便于维护和扩展。

## 硬件平台

- 微控制器：STM32F103系列
- 电机驱动：4个直流电机
- 传感器：
  - 超声波传感器（测距）
  - 4路红外循迹传感器
  - TCS34725颜色识别传感器
  - 编码器（用于速度反馈）
- 显示模块：OLED显示屏
- 按键输入：多个控制按钮

## 软件架构

项目采用模块化设计，主要包含以下功能模块：

### 1. 电机控制模块 (motorLib)

- 实现电机的PWM控制
- 支持PID速度闭环控制
- 实现小车运动学模型（电机速度到小车速度的转换）
- 支持多电机协同控制

**主要文件：**
- `motorClass.c/h` - 电机控制类实现

### 2. 超声波测距模块 (US_ranging)

- 实现超声波传感器测距功能
- 支持非阻塞式测距
- 提供距离计算和获取接口

**主要文件：**
- `US_ranging.c/h` - 超声波测距实现

### 3. 循迹模块 (traLib)

- 实现4路红外循迹传感器数据采集
- 提供传感器状态查询接口
- 支持循迹状态分析

**主要文件：**
- `trailing.c/h` - 循迹模块实现

### 4. 按键控制模块 (buttonLib)

- 实现按键扫描和状态检测
- 支持短按、长按检测
- 提供回调函数机制

**主要文件：**
- `button.c/h` - 按键控制实现

### 5. 颜色识别模块 (iic/colorRe)

- 基于TCS34725颜色传感器实现
- 支持RGB和HSL颜色空间转换
- 提供颜色识别和数据分析功能

**主要文件：**
- `colorRe.c/h` - 颜色识别实现

### 6. OLED显示模块 (iic/OLED)

- 驱动OLED显示屏
- 支持字符、数字、字符串显示
- 提供多种显示格式支持

**主要文件：**
- `OLED.c/h` - OLED显示实现
- `OLEDMenu.c` - OLED菜单实现

### 7. 内存管理模块 (memoryLib)

- 实现自定义内存池
- 提供内存分配和释放功能
- 支持内存使用情况监控

**主要文件：**
- `memoryPool.h` - 内存池定义

## 开发环境

- IDE：Keil MDK-ARM
- 固件库：STM32F1xx HAL库
- 编程语言：C语言

## 项目结构

```
course design5/
├── Core/                   # 核心代码
│   ├── Inc/               # 头文件
│   └── Src/               # 源代码
│       ├── US_ranging/     # 超声波测距模块
│       ├── buttonLib/     # 按键控制模块
│       ├── exit/          # 退出控制模块
│       ├── iic/           # I2C通信模块
│       ├── memoryLib/     # 内存管理模块
│       ├── motorLib/      # 电机控制模块
│       ├── redLib/        # 红外模块(未实现)
│       ├── time/          # 时间模块(未实现)
│       └── traLib/        # 循迹模块
├── Drivers/               # STM32驱动库
└── MDK-ARM/               # Keil工程文件
```

## 使用说明

### 硬件连接

1. 电机连接：
   - Motor1: PA0/PA1
   - Motor2: PC6/PC7
   - Motor3: PA2/PA3
   - Motor4: PB8/PB9

2. 超声波传感器：
   - Trig: PC4
   - Echo: PC5

3. 红外循迹传感器：
   - X1: PC0
   - X2: PC1
   - X3: PC2
   - X4: PC3

4. 颜色传感器(TCS34725)：
   - SCL: PC12
   - SDA: PD2

5. OLED显示屏：
   - SCL: PC12
   - SDA: PD2

6. 按键：
   - F11-F14: PC0-PC3
   - F21-F24: PB12-PB15

### 软件配置

1. 打开Keil MDK-ARM工程
2. 根据实际硬件连接修改引脚定义
3. 编译并下载程序到STM32开发板

## 功能特点

1. 多传感器融合：结合超声波、红外和颜色传感器实现环境感知
2. 精确运动控制：基于PID的电机速度闭环控制
3. 模块化设计：各功能模块独立，便于维护和扩展
4. 人机交互：通过OLED显示屏和按键实现交互

## 开发者

- 项目作者：qwqb233
- 邮箱：qwqb.zhang@gmail.com

## 许可证

本项目基于STM32 HAL库开发，遵循相关开源许可证。
